# Welcome to To-do Lists's documentation

## Run Locally

### Initial Setup

1. Import the project on [Vercel](https://vercel.com)
2. Navigate to storage and create a Neon database.
3. Install the [Vercel CLI](https://vercel.com/docs/cli).

Then run:

```bash
npm i # install dependencies
vercel link # link to Vercel project
vercel env pull .env # pull .env variable to link to Neon database
npx prisma db push # push the schema to the db
npm run dev # run dev server
```

### OAuth Providers

To sign in and use OAuth:

1. Create a [GitHub OAuth](https://github.com/settings/apps/new) application (set Authorization callback URL to `http://BASE_URL/api/auth/callback`, replacing BASE_URL with your url).
2. Add the environment variables:

````text
NEXTAUTH_URL="" # the base url of your app
NEXTAUTH_SECRET="" # run "openssl rand -base64 32" to generate the secret
GITHUB_ID="" # the GitHub client id
GITHUB_SECRET="" # the GitHub client secret

To sign in and use Google OAuth:

1. Create a google account if you don't have one
2. Create a [Google OAuth Client](https://console.cloud.google.com/apis/) (set Authorization redirect URIs to `http://BASE_URL/api/auth/callback/google`, replacing BASE_URL with your url).
3. Add the environment variables:

```text
GOOGLE_CLIENT_ID="" # The client ID generated by google
GOOGLE_CLIENT_SECRET="" # The client secret generated by google
````

### Notification Via Email

To include email notification feature:

1. You'll need an email service that provides SMTP access, such as: SendGrid, Brevo etc

2. Configure Environment Variables
   Add the following to your .env file:

```text
   EMAIL_USER # SMTP server login
   EMAIL_PASSWORD # SMTP server password
   EMAIL_HOST # smtp.example.com
   EMAIL_PORT # 465 or 587
   EMAIL_FROM=your-email@example.com # Default "from" address
```
# Code Glossary

The following is a compendium of our apps current components, this will allow any external contributors to familiarise themselves with the project's codebase.
For easy access we recommend using (Ctrl + F) and your files path to better navigate this glossary.

E.g. 
```
Ctrl + F => /lib/db/schema.prisma
```

## /lib
 
 This database schema uses the [**Prisma**](https://www.prisma.io/docs) library for its database storage and storage of information streamed to and from the client.

****
   ### /lib/db/schema.prisma

   * #### **Database Generation:** 
      * generator{} and datasource{} are responsible for initialising the client and database respectively, with datasource{} being passed environment variables to declare that the db is a postgresql db and the required URL's for it to host from.

   * #### **Custom Data Type Declarations:** 
      * Next is our custom data type declarations, the enum 'Status' contains the necessary values to be cycled through later on in our task creation/ edit functions,
      the enum priority also follows a similar structure and use in our project.

   * #### **Relations:**
      * Cross model relations are typically represented by a statement resembling the following: 
      > `<ExternalModelName>  <InternalFieldName>? @relation(fields: [<ForeignKeyField>], references: [<ForeignPrimaryKeyField])`
      * In this instance the `<ExternalModelName>` and `<ForeignPrimaryKeyField>` are the typical Foreign Table and Foreign Primary Key you would expect to see in a `SQL FOREIGN KEY` declaration.
      * One-to-many relations are handled by the `<InternalFieldName>` being superceded by a `[]`, to represent a multitude of values

   * #### **Model Declarations:** 
      * **List:** This model contains the relevant items a list would require (id, title, backgroundColour) as well as values useful in relating lists to the users who will be accessing them:
         > userId => The user whom this list 'belongs' to | Todo[] => A listing of all the Todo's nested within this List (This is critical in the loading and saving of a user's lists)

      * **Todo:** Like List, this contains the standard fields expected of a Todo List entry (id, title, content), as well as our custom Priority and Status [**enums**](#custom-data-type-declarations). 

         * **Some fields unique to Todo are:**

         * > notification => The time before the set deadline that a reminder will be sent out.
         * > deadline => The date in which this task should be completed by.
         * > reminderDate => Stores the calculated value of when the user needs to receive a reminder regarding that particular.
         * > remindedAt => This value is kept null to reset the logic of the reminder status when updating the reminderDate.

      * **Account:** 
         * This model mostly contains information used in authentication and the network used in this project.
         * The `userId` in this model maps the relevant `userId` from the `User` model, ensuring account details and information are kept consistent across devices/ connections.

         * **Details used in account authentication:**
            * > type => The type of account used e.g. `"email"` or `"oauth"`
            * > provider => Which service is used to authenticate the user e.g. `"Google"` or `"GitHub`
            * > providerAccountId => The unique identifier given by the service provider is then mapped to this accounts details

         * A number of optional `OAuth` fields are then stored in the event that the chosen provider returns a value for that row (Not all providers distribute the same tokens/ session-data)

            |     Row Name       |     Data Type     |
            |--------------------|-------------------|
            | refresh_token      | (Optional) String |
            | access_token       | (Optional) String |
            | expires_at         | (Optional) Int    |
            | token_type         | (Optional) String |
            | scope              | (Optional) String |
            | id_token           | (Optional) String |
            | session_state      | (Optional) String |
            | oauth_token_secret | (Optional) String |
            | oauth_token        | (Optional) String |

      * **Session:**

         * This model tracks the relevant user's sessionToken, ensuring that session's are maintained properly by utilising the expires field to purge/ validate the affected sessions

      * **User:**

         * This model includes some typical user credentials such as name, email and password.

         * The large bulk of storage within this model is the User's relations to all of the aforementioned tables, these include:

            |      Row Name      |   Data Type   |
            |--------------------|---------------|
            |      Account       |   Account[]   |
            |      Session       |   Session[]   |
            |       todos        |    Todo[]     |
            |    ownedLists      |    List[]     |    
            | collaboratingLists |    List[]     |    

         * For some additional information, createdAt and updatedAt are also mapped to their respective user when any changes are made involving the prisma db.


      * **VerificationToken:** 

         * This model greatly aids any functions regarding verification of a user by storing a users identifier and unique token for the session/ until it expires.

         * The unique constraint `@@unique([identifier, token])` also allows for easier querying of this particular model due to the component logic enforcing that `identifier` + `token` must be unique.
****
   ### lib/auth.js

   * **authOptions():** This function is supported by [**NextAuth.js**](https://next-auth.js.org/getting-started/introduction), a subsection of [**Next.js**](https://nextjs.org/docs) which focuses heavily on authenticating and validating data.

      * First, the necessary declarations and default options are adjusted to better work with the program
         * > adapter: => `PrismaAdapter(prisma)` is passed to integrate NextAuth with our [ORM](https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping) of choice (In this case, prisma).
         * > pages: => `/login` this overrides the default page to be loaded by NextAuth with what we want to be loaded
         * > session: => `"jwt"` uses [*JSON Web Tokens*](https://auth0.com/docs/secure/tokens/json-web-tokens) for session management, these are stored client-side and therefore reduce database lookups.
         * > providers: => The array `[GitHubProvider, GoogleProvider, CredentialsProvider]` is passed here, GitHub and Google use their respective `clientId` and `clientSecret` environment variables, while `CredentialsProvider` allows for custom logic to be passed (e.g. typical input of an email and password).

      * **authorize(credentials):** 

         * These credentials are then parsed and validated to ensure null/ undefined values arent passed on
         * The email and password of the user logging in are seperately checked against the prisma database, providing unique errors on fail
         * If all tests are passed, an object of `{id, name, email, image}` is returned 

         * **callbacks{}:**
            
            * `jwt({ token, user })` assigns a user's id to a token once they have logged in

            * `session({ session, token })` Then completes this by assigning the token to a valid session

      * `secret: process.env.NEXTAUTH_SECRET` then encrypts our session's key by adding a long and randomly generated string to the end of a JWT
****
   ### lib/mailer.js
   This file is responsible for the sending of the notification reminder for a user's tasks that have a deadline (e.g. "You have 1 week before your deadline!"), it utlises the NodeMailer library to .

   * First an 

   * mailer.js explanation

****
   ### lib/prisma.js

   * prisma.js explanation

   ### lib/schema.js

   * schema.js explanation

****
## node_modules

Here belongs all of the necessary dependencies required for this project installed by running `npm i`, however the length and contents of this directory are subject to change over the course of the app's lifetime.
> For a better explanation of node modules or npm in general, please visit [the npm site](https://docs.npmjs.com/about-npm)

****
## /public

#### *To be continued...*