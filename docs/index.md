# Welcome to To-do Lists's documentation

## Run Locally

### Initial Setup

1. Import the project on [Vercel](https://vercel.com)
2. Navigate to storage and create a Neon database.
3. Install the [Vercel CLI](https://vercel.com/docs/cli).

Then run:

```bash
npm i # install dependencies
vercel link # link to Vercel project
vercel env pull .env # pull .env variable to link to Neon database
npx prisma db push # push the schema to the db
npm run dev # run dev server
```

### OAuth Providers

To sign in and use OAuth:

1. Create a [GitHub OAuth](https://github.com/settings/apps/new) application (set Authorization callback URL to `http://BASE_URL/api/auth/callback`, replacing BASE_URL with your url).
2. Add the environment variables:

````text
NEXTAUTH_URL="" # the base url of your app
NEXTAUTH_SECRET="" # run "openssl rand -base64 32" to generate the secret
GITHUB_ID="" # the GitHub client id
GITHUB_SECRET="" # the GitHub client secret

To sign in and use Google OAuth:

1. Create a google account if you don't have one
2. Create a [Google OAuth Client](https://console.cloud.google.com/apis/) (set Authorization redirect URIs to `http://BASE_URL/api/auth/callback/google`, replacing BASE_URL with your url).
3. Add the environment variables:

```text
GOOGLE_CLIENT_ID="" # The client ID generated by google
GOOGLE_CLIENT_SECRET="" # The client secret generated by google
````

### Notification Via Email

To include email notification feature:

1. You'll need an email service that provides SMTP access, such as: SendGrid, Brevo etc

2. Configure Environment Variables
   Add the following to your .env file:

```text
   EMAIL_USER # SMTP server login
   EMAIL_PASSWORD # SMTP server password
   EMAIL_HOST # smtp.example.com
   EMAIL_PORT # 465 or 587
   EMAIL_FROM=your-email@example.com # Default "from" address
```
# Code Glossary

The following is a compendium of our apps current components, this will allow any external contributors to familiarise themselves with the project's codebase.
For easy access we recommend using (Ctrl + F) and your files path to better navigate this glossary.

> E.g. `Ctrl + F => /lib/db/schema.prisma`

Index: (possible tree with nodes as links for easier access and readability)

## /lib
 
 This database schema uses the [**Prisma**](https://www.prisma.io/docs) library for its database storage and storage of information streamed to and from the client.

****

### /lib/db/schema.prisma

   * ### **Database Generation:** 
      * generator{} and datasource{} are responsible for initialising the client and database respectively, with datasource{} being passed environment variables to declare that the db is a postgresql db and the required URL's for it to host from.

   * ### **Custom Data Type Declarations:** 
      * Next is our custom data type declarations, the enum 'Status' contains the necessary values to be cycled through later on in our task creation/ edit functions,
      the enum priority also follows a similar structure and use in our project.

   * ### **Relations:**
      * Cross model relations are typically represented by a statement resembling the following: 
      > `<ExternalModelName>  <InternalFieldName>? @relation(fields: [<ForeignKeyField>], references: [<ForeignPrimaryKeyField])`
      * In this instance the `<ExternalModelName>` and `<ForeignPrimaryKeyField>` are the typical Foreign Table and Foreign Primary Key you would expect to see in a `SQL FOREIGN KEY` declaration.
      * One-to-many relations are handled by the `<InternalFieldName>` being superceded by a `[]`, to represent a multitude of values

   * ### **Model Declarations:** 
      * **List:** This model contains the relevant items a list would require (id, title, backgroundColour) as well as values useful in relating lists to the users who will be accessing them:
         > userId => The user whom this list 'belongs' to | Todo[] => A listing of all the Todo's nested within this List (This is critical in the loading and saving of a user's lists)

      * **Todo:** Like List, this contains the standard fields expected of a Todo List entry (id, title, content), as well as our custom Priority and Status [**enums**](#custom-data-type-declarations). 

         * **Some fields unique to Todo are:**

         * > notification => The time before the set deadline that a reminder will be sent out.
         * > deadline => The date in which this task should be completed by.
         * > reminderDate => Stores the calculated value of when the user needs to receive a reminder regarding that particular.
         * > remindedAt => This value is kept null to reset the logic of the reminder status when updating the reminderDate.

      * **Account:** 
         * This model mostly contains information used in authentication and the network used in this project.
         * The `userId` in this model maps the relevant `userId` from the `User` model, ensuring account details and information are kept consistent across devices/ connections.

         * **Details used in account authentication:**
            * > type => The type of account used e.g. `"email"` or `"oauth"`
            * > provider => Which service is used to authenticate the user e.g. `"Google"` or `"GitHub`
            * > providerAccountId => The unique identifier given by the service provider is then mapped to this accounts details

         * A number of optional `OAuth` fields are then stored in the event that the chosen provider returns a value for that row (Not all providers distribute the same tokens/ session-data)

            |     Row Name       |     Data Type     |
            |--------------------|-------------------|
            | refresh_token      | (Optional) String |
            | access_token       | (Optional) String |
            | expires_at         | (Optional) Int    |
            | token_type         | (Optional) String |
            | scope              | (Optional) String |
            | id_token           | (Optional) String |
            | session_state      | (Optional) String |
            | oauth_token_secret | (Optional) String |
            | oauth_token        | (Optional) String |

      * **Session:**

         * This model tracks the relevant user's sessionToken, ensuring that session's are maintained properly by utilising the expires field to purge/ validate the affected sessions

      * **User:**

         * This model includes some typical user credentials such as name, email and password.

         * The large bulk of storage within this model is the User's relations to all of the aforementioned tables, these include:

            |      Row Name      |   Data Type   |
            |--------------------|---------------|
            |      Account       |   Account[]   |
            |      Session       |   Session[]   |
            |       todos        |    Todo[]     |
            |    ownedLists      |    List[]     |    
            | collaboratingLists |    List[]     |    

         * For some additional information, createdAt and updatedAt are also mapped to their respective user when any changes are made involving the prisma db.


      * **VerificationToken:** 

         * This model greatly aids any functions regarding verification of a user by storing a users identifier and unique token for the session/ until it expires.

         * The unique constraint `@@unique([identifier, token])` also allows for easier querying of this particular model due to the component logic enforcing that `identifier` + `token` must be unique.
****
   ### lib/auth.js

   * **authOptions():** This function is supported by [**NextAuth.js**](https://next-auth.js.org/getting-started/introduction), a subsection of [**Next.js**](https://nextjs.org/docs) which focuses heavily on authenticating and validating data.

      * First, the necessary declarations and default options are adjusted to better work with the program
         * > adapter: => `PrismaAdapter(prisma)` is passed to integrate NextAuth with our [ORM](https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping) of choice (In this case, prisma).
         * > pages: => `/login` this overrides the default page to be loaded by NextAuth with what we want to be loaded
         * > session: => `"jwt"` uses [*JSON Web Tokens*](https://auth0.com/docs/secure/tokens/json-web-tokens) for session management, these are stored client-side and therefore reduce database lookups.
         * > providers: => The array `[GitHubProvider, GoogleProvider, CredentialsProvider]` is passed here, GitHub and Google use their respective `clientId` and `clientSecret` environment variables, while `CredentialsProvider` allows for custom logic to be passed (e.g. typical input of an email and password).

      * **authorize(credentials):** 

         * These credentials are then parsed and validated to ensure null/ undefined values arent passed on.
         * The email and password of the user logging in are seperately checked against the prisma database, providing unique errors on fail.
         * If all tests are passed, an object of `{id, name, email, image}` is returned.

         * **callbacks{}:**
            
            * `jwt({ token, user })` assigns a user's id to a token once they have logged in.

            * `session({ session, token })` Then completes this by assigning the token to a valid session.

      * `secret: process.env.NEXTAUTH_SECRET` then encrypts our session's key by adding a long and randomly generated string to the end of a JWT.
****
   ### lib/mailer.js
   This file is responsible for the sending of the notification reminder for a user's tasks that have a deadline (e.g. "You have 1 week before your deadline!"), it utlises the [NodeMailer](https://nodemailer.com/) library to structure and send emails to the desired recipient(s).

   * `transporter` is an integral part of NodeMailer that is able to successfully send an email with the values passed to it `{ host, port, secure, auth { user, pass }}`. All values except `secure => (boolean)` are passed from environment variables to these fields.

   * **sendReminder(task, list)**

> recipients => maps each entry of the list parameter to that users email, producing a list of endpoints for the email to be sent.
> date => calls dateFormatterformats the deadline date from a Date() value into something more readable for the user (e.g. Wednesday, 14 November 2025 at 13:45:00) 

   * **transporter.sendMail()**

      * the `.sendMail()` function assigns fields of a passed object typical to that of a normal email:
> from: => 
> to: => takes `recipients` and joins each item by `", "` to appropriately chain all email addresses.
> subject: => Takes the `task.title` and `date` to provide an automated subject field.
> text: takes various fields from the `task` object and formats it in a welcoming and friendly pre-written message to notify them their task is due in X amount of time.

****
   ### lib/prisma.js
   This file is responsible for establishing the prisma client using the [prisma library](https://www.prisma.io/docs)

   * checks if the app is running in `"development"` or `"production"` mode, in production, code runs once so calling a new client each instance is safe. However in development, the server typically refreshes after each file change putting strain on the database from numerous redundant connections.

****
   ### lib/schema.js
   This file contains the code responsible for passing formatted credentials to our authentication functions

   * **createAuthSchema()**

      * This creates an object to be used in the authorisation for users logging in/ registering
         * Contains fields `{ name, email, password }`, all of these have constraints and default values to enforce valid inputs and maintain consistency in terms of formatting.

****
## node_modules

Here belongs all of the necessary dependencies required for this project installed by running `npm i`, however the length and contents of this directory are subject to change over the course of the app's lifetime.
> For a better explanation of node modules or npm in general, please visit [the npm site](https://docs.npmjs.com/about-npm)

****
## /public
This directory holds all images, these have been used for backdrops and placeholders

* Use of the Next.js `Image` component has also been utilised for its increased performance and optimisation [src/app/page.jsx](#srcapppagejsx)

****
## /src

   ### src/app

   * ### src/app/(auth)

      * ### src/app/(auth)/login
         * Imports all of the necessary components from [`"/ui/card.jsx"`](#srccomponentsuicardjsx) and arranges them to build the login ui of the app.

      * ### src/app/(auth)/signup
         * Almost identical to `"src/app/(auth)/login"` in terms of the imported components, with the only difference being some contextual text differences between logging in and registering.

      * ### src/app/(auth)/layout.jsx
         * Checks if a user is already authenticated, redirecting to the dashboard if so.
         * If not, the desired layout is injected into the `"children"` parameter of div `className="flex flex-1 items-center justify-center w-full"`
****
   * ### src/app/actions
      * ### src/app/actions
         * ### src/app/actions/group.js
            * `groupSchema` defines a [**zod**](https://zod.dev/?id=table-of-contents) schema for an array of list collaborators, with validation for each entry with the `.refine()` function
            * `createGroup(listId, formState, formData)`: Stores the parsed list of collaborators for use in fetching them by their emails, if successful the prisma schema for that List is updated with the collaborators appended to the list of authors.  
            * `deleteGroup(listId)`: Removes all collaborators of a list and redirects out of that (no longer existing) group's url.

         * ### src/app/actions/list.js
            * `todoSchema` defines a zod schema for a list object, containing a title and backgroundColour with relevant input constraints
            * `createList(formState, formData)`: stores a parsed `todoSchema` object to have its fields passed into the prisma `.create({ data: })` object 
            * `updateList(listId, formState, formData)`: stores a parsed `todoSchema` object to have its fields passed into a prisma `.update({ where, data })`, with `listId` identifying the list to be updated, and the parsed values overwriting the values of that list.
            * `deleteList(listId)`: If the passed `listId` is found within the prisma schema, `.delete()` is called on that list's ID, with errors being produced if not.

         * ### src/app/actions/todo.js
            * `todoSchema` defines a zod schema for a to-do-list entry, containing a title, content, priority, deadline, notification and status. Each of these fields has the constraints and input requirements established at their declaration with zod's [**primitives**](https://zod.dev/?id=primitives)
            * `createTodo(listId, type, formState, formData)`:
            * `updateTodo(id, listId, type, formState, status)`:
            * `updateTodoStatus(id, listId, type, status)`:
****
   * ### src/app/api
      * ### src/app/api/auth
         * ### src/app/api/auth/[...nextauth]/route.js
            * This file loads the authentication options we previously declared in [lib/auth](#libauthjs) for use in our GET and POST requests.
         
         * ### src/app/api/auth/signup/route.js
            * This file handles the signup functionality of our login system, as the fields parsed from our zod schema [signUpSchema](#libschemajs) are checked against the database for existing accounts.
            * The parsed password is hashed using [bcrypt](https://www.npmjs.com/package/bcrypt) and excluded from the userData object to avoid exposing sensitive information in the response messages

      * ### src/app/api/cron
         * ### src/app/api/cron/route.js
            * [`checkAndSendReminders()`](#srclibreminderchecksjs) is used here to gather a list of users who have not yet been reminded about the deadline of their task (based on their `notification` setting) and send out a wave of pre-written reminder emails.

      * ### src/app/api/index.js
         * This file only exports the `src/app/api/[...nextauth]/route` code.
****
   * ### src/app/dashboard
      * ### src/app/dashboard/group
         * ### src/app/dashboard/group/[listId]/todo
            * ### src/app/dashboard/group/[listId]/todo/[id]/edit/page.jsx
               * `PostsEdit({ params })` Updates a user's todo list by pulling the cached list and updating its initialData fields. Cache is used here for greatly increased efficiency and speed when fetching.

            * ### src/app/dashboard/group/[listId]/todo/[id]/add/page.jsx
               * Solely return the TodoForm function component with appropriate default values for its `initialData` parameter: `initialData={{title: "", content: "", priority: "", status: ""}}`
               
            * ### src/app/dashboard/group/[listId]/todo/page.jsx
               * This file uses the function components [`Todos`](#srccomponentstodos), [`PageHeader`](#srccomponentspageheaderjsx) and [`Button`](#srccomponentsusbuttonjsx) to form the list of group tasks a user is collaborating on. 

         * ### src/app/dashboard/group/page.jsx
            * This file uses the [`PageHeader`](#srccomponentspageheaderjsx) and [`Groups`](#srccomponentsgroupsjsx) function components to form the group page/ dashboard.
      ****
      * ### src/app/dashboard/list
         * ### src/app/dashboard/list/[listId]
            * ### src/app/dashboard/list/[listId]/edit/page.jsx
               * Also uses the `PostsEdit({ params })` function to return a new [`ListForm`](#srccomponentslistform) for a created [`List`](#srccomponentslist) with updated values passed into the form's `initialData` fields.

            * ### src/app/dashboard/list/[listId]/todo
               * ### src/app/dashboard/list/[listId]/todo/[id]/edit/page.jsx
                  * Again, uses `PostsEdit({ params })` to return an updated Todo Form, this time with updated `initialData` field values.
               * ### src/app/dashboard/list/[listId]/todo/add/page.jsx
                  * `userTodoAdd({ params })` calls [`createTodo`](#srcappactionstodojs) to initialise a valid listId within the database and append the function component [TodoForm](#srccomponentstodoform) to that new list.
               * ### src/app/dashboard/list/[listId]/todo/page.jsx
                  * `UserList({ params })` uses cache to fetch a user's list and display it using the [`PageHeader`](#srccomponentspageheaderjsx), [`Button`](#srccomponentsusbuttonjsx), [`AddCollaborators`](#srccomponentsaddcollaboratorsjsx), [`ListDelete`](#srccomponentslistdelete) and [`Todos`](#srccomponentstodos) function components to format the page.

         * ### src/app/dashboard/list/add/page.jsx
            * `UserListAdd()` returns a [`ListForm`](#srccomponentslistform) with the [`createList`](#srcappactionslistjs) logic being passed as the formAction.

         * ### src/app/dashboard/list/page.jsx
            * `UserLists()` returns a page that fetches and displays all of a users currently created [`Lists`](#srccomponentslists), with the option to create a new list by redirecting to [`/dashboard/list/add`](#srcappdashboardlistaddpagejsx).


      * ### src/app/dashboard/settings
         * ### src/app/dashboard/settings/index.jsx
            * `SettingsPage({ userData })` declares the structure of the settings page, along with some handlers for customisable features such as the theme, font, boldness, of text.
            * The distinct sections of `Account`, `Theme`, `Font Size` and `Font Boldness` are also defined and composed of function components from the `/components/ui` directory.

         * ### src/app/dashboard/settings/page.jsx
            * `Settings()` is used to validate the user's session, then return the function component `<SettingsPage/>` in a more modularised form to reduce code bloating on our main page hosting multiple function components.

      * ### src/app/dashboard/layout.jsx
         * `AuthLayout({ children })` validates a user's session before returning the logic and layout of the [`<Sidebar/>`](#srccomponentssidebar) for use on the display pages of the app.

      * ### src/app/dashboard/page.jsx
         *  This file combines all of the html and React components to form our home page, only after that user's session has been validated.

   * ### src/app/globals.css
      * This file provides dynamic theming through the use of [`oklch()`](https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/oklch) and [`tailwind CSS`](https://tailwindcss.com/docs/installation/using-vite).
      * This holds some of the presets for global settings like the light and dark-mode feature

   * ### src/app/layout.jsx
      * `RootLayout({ children })` declares and initialises some of the variables used in [`<ThemeProvider>`](#srccomponentsuitheme-providerjsx).

   * ### src/app/page.jsx
      * `LandingPage()` returns all of the html and embedded React components to create the initial page that is displayed on load, from here a user will either login or signup and enter the protected directories of the app.


****
   * ### src/components 
      * ### src/components/List
      * ### src/components/ListDelete
      * ### src/components/ListForm
      * ### src/components/Lists
      * ### src/components/Nav
      * ### src/components/SessionWrapper
      * ### src/components/Sidebar
      * ### src/components/TestButton
      * ### src/components/Todo
      * ### src/components/TodoForm
      * ### src/components/Todos
      * ### src/components/ui 
         * ### src/components/ui/button.jsx
         * ### src/components/ui/card.jsx
         * ### src/components/ui/theme-provider.jsx
         * > This is an incomplete component directory, files that need linking to will be added ahead of the main bulk of content
      * ### src/components/AddCollaborators.jsx
      * ### src/components/Groups.jsx
      * ### src/components/PageHeader.jsx
****
   * ### src/hooks
****
   * ### src/lib
      * ### src/lib/reminderChecks.js
      * ### src/lib/utils.js
****
   * ### src/utils
****
#### *To be continued...*